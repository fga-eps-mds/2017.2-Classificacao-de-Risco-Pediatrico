{% extends 'users/user_home/home_layout.html' %}
{% load staticfiles %}

{% block content_pos %}

    <div id="container" style="height: 80%"></div>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
      <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
      <script type="text/javascript">
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var legend_data = [];
        var series_data = [];
        var app = {};

        buildData(legend_data, series_data);

        console.log(legend_data);
        option = null;
        option = {
         title : {
             text: 'Gráfico de Classificações',
             subtext: 'Análise de percentual',
             x:'center'
         },
         tooltip : {
             trigger: 'item',
             formatter: "{a} <br/>{b} : {c} ({d}%)"
         },
         legend: {
             orient: 'vertical',
             left: 'left',
             data: legend_data
         },
         series : [
             {
                 name: 'Pie Chart',
                 type: 'pie',
                 radius : '55%',
                 center: ['50%', '50%'],
                 data: series_data,
                 itemStyle: {
                     emphasis: {
                         shadowBlur: 10,
                         shadowOffsetX: 0,
                         shadowColor: 'rgba(0, 0, 0, 0.5)'
                     }
                 }
             }
         ]
        };
        ;
        if (option && typeof option === "object") {
         myChart.setOption(option, true);
        }

        function buildData( legend_data, series_data){
          if ({{data.AtendimentoImediato}} != 0){
            legend_data.push("Atendimento Imediato");
            series_data.push({value:{{data.AtendimentoImediato}}, name:'Atendimento Imediato'});
          }
          if ({{data.AtendimentoHospitalar}} != 0){
            legend_data.push("Atendimento Hospitalar");
            series_data.push({value:{{data.AtendimentoHospitalar}}, name:'Atendimento Hospitalar'});
          }
          if ({{data.AtendimentoAmbulatorial}} != 0){
            legend_data.push("Atendimento Ambulatorial");
            series_data.push({value:{{data.AtendimentoAmbulatorial}}, name:'Atendimento Ambulatorial'});
          }
          if ({{data.AtendimentoEletivo}} != 0){
            legend_data.push("Atendimento Eletivo");
            series_data.push({value:{{data.AtendimentoEletivo}}, name:'Atendimento Eletivo'});
          }
        }

      </script>
    </div>

{% endblock %}
